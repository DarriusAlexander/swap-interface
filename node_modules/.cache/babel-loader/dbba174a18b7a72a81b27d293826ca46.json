{"ast":null,"code":"import{useCallback,useMemo}from'react';import{useDispatch,useSelector}from'react-redux';import{useActiveWeb3React}from'../../hooks';import{addTransaction}from'./actions';// helper that can take a ethers library transaction response and add it to the list of transactions\nexport function useTransactionAdder(){var _useActiveWeb3React=useActiveWeb3React(),chainId=_useActiveWeb3React.chainId,account=_useActiveWeb3React.account;var dispatch=useDispatch();return useCallback(function(response){var _ref=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{},summary=_ref.summary,approval=_ref.approval,claim=_ref.claim;if(!account)return;if(!chainId)return;var hash=response.hash;if(!hash){throw Error('No transaction hash found.');}dispatch(addTransaction({hash:hash,from:account,chainId:chainId,approval:approval,summary:summary,claim:claim}));},[dispatch,chainId,account]);}// returns all the transactions for the current chain\nexport function useAllTransactions(){var _state$chainId;var _useActiveWeb3React2=useActiveWeb3React(),chainId=_useActiveWeb3React2.chainId;var state=useSelector(function(state){return state.transactions;});return chainId?(_state$chainId=state[chainId])!==null&&_state$chainId!==void 0?_state$chainId:{}:{};}export function useIsTransactionPending(transactionHash){var transactions=useAllTransactions();if(!transactionHash||!transactions[transactionHash])return false;return!transactions[transactionHash].receipt;}/**\r\n * Returns whether a transaction happened in the last day (86400 seconds * 1000 milliseconds / second)\r\n * @param tx to check for recency\r\n */export function isTransactionRecent(tx){return new Date().getTime()-tx.addedTime<86400000;}// returns whether a token has a pending approval transaction\nexport function useHasPendingApproval(tokenAddress,spender){var allTransactions=useAllTransactions();return useMemo(function(){return typeof tokenAddress==='string'&&typeof spender==='string'&&Object.keys(allTransactions).some(function(hash){var tx=allTransactions[hash];if(!tx)return false;if(tx.receipt){return false;}else{var approval=tx.approval;if(!approval)return false;return approval.spender===spender&&approval.tokenAddress===tokenAddress&&isTransactionRecent(tx);}});},[allTransactions,spender,tokenAddress]);}// watch for submissions to claim\n// return null if not done loading, return undefined if not found\nexport function useUserHasSubmittedClaim(account){var allTransactions=useAllTransactions();// get the txn if it has been submitted\nvar claimTxn=useMemo(function(){var txnIndex=Object.keys(allTransactions).find(function(hash){var tx=allTransactions[hash];return tx.claim&&tx.claim.recipient===account;});return txnIndex&&allTransactions[txnIndex]?allTransactions[txnIndex]:undefined;},[account,allTransactions]);return{claimSubmitted:Boolean(claimTxn),claimTxn:claimTxn};}","map":{"version":3,"sources":["C:/Users/Darrius/Documents/GitHub/swap-interface/src/state/transactions/hooks.tsx"],"names":["useCallback","useMemo","useDispatch","useSelector","useActiveWeb3React","addTransaction","useTransactionAdder","chainId","account","dispatch","response","summary","approval","claim","hash","Error","from","useAllTransactions","state","transactions","useIsTransactionPending","transactionHash","receipt","isTransactionRecent","tx","Date","getTime","addedTime","useHasPendingApproval","tokenAddress","spender","allTransactions","Object","keys","some","useUserHasSubmittedClaim","claimTxn","txnIndex","find","recipient","undefined","claimSubmitted","Boolean"],"mappings":"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","sourcesContent":["import { TransactionResponse } from '@ethersproject/providers'\r\nimport { useCallback, useMemo } from 'react'\r\nimport { useDispatch, useSelector } from 'react-redux'\r\n\r\nimport { useActiveWeb3React } from '../../hooks'\r\nimport { AppDispatch, AppState } from '../index'\r\nimport { addTransaction } from './actions'\r\nimport { TransactionDetails } from './reducer'\r\n\r\n// helper that can take a ethers library transaction response and add it to the list of transactions\r\nexport function useTransactionAdder(): (\r\n  response: TransactionResponse,\r\n  customData?: { summary?: string; approval?: { tokenAddress: string; spender: string }; claim?: { recipient: string } }\r\n) => void {\r\n  const { chainId, account } = useActiveWeb3React()\r\n  const dispatch = useDispatch<AppDispatch>()\r\n\r\n  return useCallback(\r\n    (\r\n      response: TransactionResponse,\r\n      {\r\n        summary,\r\n        approval,\r\n        claim\r\n      }: { summary?: string; claim?: { recipient: string }; approval?: { tokenAddress: string; spender: string } } = {}\r\n    ) => {\r\n      if (!account) return\r\n      if (!chainId) return\r\n\r\n      const { hash } = response\r\n      if (!hash) {\r\n        throw Error('No transaction hash found.')\r\n      }\r\n      dispatch(addTransaction({ hash, from: account, chainId, approval, summary, claim }))\r\n    },\r\n    [dispatch, chainId, account]\r\n  )\r\n}\r\n\r\n// returns all the transactions for the current chain\r\nexport function useAllTransactions(): { [txHash: string]: TransactionDetails } {\r\n  const { chainId } = useActiveWeb3React()\r\n\r\n  const state = useSelector<AppState, AppState['transactions']>(state => state.transactions)\r\n\r\n  return chainId ? state[chainId] ?? {} : {}\r\n}\r\n\r\nexport function useIsTransactionPending(transactionHash?: string): boolean {\r\n  const transactions = useAllTransactions()\r\n\r\n  if (!transactionHash || !transactions[transactionHash]) return false\r\n\r\n  return !transactions[transactionHash].receipt\r\n}\r\n\r\n/**\r\n * Returns whether a transaction happened in the last day (86400 seconds * 1000 milliseconds / second)\r\n * @param tx to check for recency\r\n */\r\nexport function isTransactionRecent(tx: TransactionDetails): boolean {\r\n  return new Date().getTime() - tx.addedTime < 86_400_000\r\n}\r\n\r\n// returns whether a token has a pending approval transaction\r\nexport function useHasPendingApproval(tokenAddress: string | undefined, spender: string | undefined): boolean {\r\n  const allTransactions = useAllTransactions()\r\n  return useMemo(\r\n    () =>\r\n      typeof tokenAddress === 'string' &&\r\n      typeof spender === 'string' &&\r\n      Object.keys(allTransactions).some(hash => {\r\n        const tx = allTransactions[hash]\r\n        if (!tx) return false\r\n        if (tx.receipt) {\r\n          return false\r\n        } else {\r\n          const approval = tx.approval\r\n          if (!approval) return false\r\n          return approval.spender === spender && approval.tokenAddress === tokenAddress && isTransactionRecent(tx)\r\n        }\r\n      }),\r\n    [allTransactions, spender, tokenAddress]\r\n  )\r\n}\r\n\r\n// watch for submissions to claim\r\n// return null if not done loading, return undefined if not found\r\nexport function useUserHasSubmittedClaim(\r\n  account?: string\r\n): { claimSubmitted: boolean; claimTxn: TransactionDetails | undefined } {\r\n  const allTransactions = useAllTransactions()\r\n\r\n  // get the txn if it has been submitted\r\n  const claimTxn = useMemo(() => {\r\n    const txnIndex = Object.keys(allTransactions).find(hash => {\r\n      const tx = allTransactions[hash]\r\n      return tx.claim && tx.claim.recipient === account\r\n    })\r\n    return txnIndex && allTransactions[txnIndex] ? allTransactions[txnIndex] : undefined\r\n  }, [account, allTransactions])\r\n\r\n  return { claimSubmitted: Boolean(claimTxn), claimTxn }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}