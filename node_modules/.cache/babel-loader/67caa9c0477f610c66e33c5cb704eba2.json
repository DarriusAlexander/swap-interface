{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\Darrius\\\\Documents\\\\GitHub\\\\swap-interface\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\Darrius\\\\Documents\\\\GitHub\\\\swap-interface\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"C:\\\\Users\\\\Darrius\\\\Documents\\\\GitHub\\\\swap-interface\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"C:\\\\Users\\\\Darrius\\\\Documents\\\\GitHub\\\\swap-interface\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import{UNI,PRELOADED_PROPOSALS}from'./../../constants/index';import{TokenAmount}from'@uniswap/sdk';import{isAddress}from'ethers/lib/utils';import{useGovernanceContract,useUniContract}from'../../hooks/useContract';import{useSingleCallResult,useSingleContractMultipleData}from'../multicall/hooks';import{useActiveWeb3React}from'../../hooks';import{ethers,utils}from'ethers';import{calculateGasMargin}from'../../utils';import{useTransactionAdder}from'../transactions/hooks';import{useState,useEffect,useCallback}from'react';import{abi as GOV_ABI}from'@uniswap/governance/build/GovernorAlpha.json';var enumerateProposalState=function enumerateProposalState(state){var proposalStates=['pending','active','canceled','defeated','succeeded','queued','expired','executed'];return proposalStates[state];};// get count of all proposals made\nexport function useProposalCount(){var gov=useGovernanceContract();var res=useSingleCallResult(gov,'proposalCount');if(res.result&&!res.loading){return parseInt(res.result[0]);}return undefined;}/**\r\n * Need proposal events to get description data emitted from\r\n * new proposal event.\r\n */export function useDataFromEventLogs(){var _govContract$filters;var _useActiveWeb3React=useActiveWeb3React(),library=_useActiveWeb3React.library;var _useState=useState(),_useState2=_slicedToArray(_useState,2),formattedEvents=_useState2[0],setFormattedEvents=_useState2[1];var govContract=useGovernanceContract();// create filter for these specific events\nvar filter=_objectSpread(_objectSpread({},govContract===null||govContract===void 0?void 0:(_govContract$filters=govContract.filters)===null||_govContract$filters===void 0?void 0:_govContract$filters['ProposalCreated']()),{},{fromBlock:0,toBlock:'latest'});var eventParser=new ethers.utils.Interface(GOV_ABI);useEffect(function(){function fetchData(){return _fetchData.apply(this,arguments);}function _fetchData(){_fetchData=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var pastEvents,formattedEventData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return library===null||library===void 0?void 0:library.getLogs(filter);case 2:pastEvents=_context.sent;// reverse events to get them from newest to odlest\nformattedEventData=pastEvents===null||pastEvents===void 0?void 0:pastEvents.map(function(event){var eventParsed=eventParser.parseLog(event).args;return{description:eventParsed.description,details:eventParsed.targets.map(function(target,i){var signature=eventParsed.signatures[i];var _signature$substr$spl=signature.substr(0,signature.length-1).split('('),_signature$substr$spl2=_slicedToArray(_signature$substr$spl,2),name=_signature$substr$spl2[0],types=_signature$substr$spl2[1];var calldata=eventParsed.calldatas[i];var decoded=utils.defaultAbiCoder.decode(types.split(','),calldata);return{target:target,functionSig:name,callData:decoded.join(', ')};})};}).reverse();setFormattedEvents(formattedEventData);case 5:case\"end\":return _context.stop();}}},_callee);}));return _fetchData.apply(this,arguments);}if(!formattedEvents){fetchData();}},[eventParser,filter,library,formattedEvents]);return formattedEvents;}// get data for all past and active proposals\nexport function useAllProposalData(){var proposalCount=useProposalCount();var govContract=useGovernanceContract();var proposalIndexes=[];for(var i=1;i<=(proposalCount!==null&&proposalCount!==void 0?proposalCount:0);i++){proposalIndexes.push([i]);}// get metadata from past events\nvar formattedEvents=useDataFromEventLogs();// get all proposal entities\nvar allProposals=useSingleContractMultipleData(govContract,'proposals',proposalIndexes);// get all proposal states\nvar allProposalStates=useSingleContractMultipleData(govContract,'state',proposalIndexes);if(formattedEvents&&allProposals&&allProposalStates){allProposals.reverse();allProposalStates.reverse();return allProposals.filter(function(p,i){var _allProposalStates$i;return Boolean(p.result)&&Boolean((_allProposalStates$i=allProposalStates[i])===null||_allProposalStates$i===void 0?void 0:_allProposalStates$i.result)&&Boolean(formattedEvents[i]);}).map(function(p,i){var _allProposals$i,_allProposals$i$resul,_allProposals$i2,_allProposals$i2$resu,_enumerateProposalSta,_allProposalStates$i2,_allProposalStates$i3,_allProposals$i3,_allProposals$i3$resu,_allProposals$i4,_allProposals$i4$resu,_allProposals$i5,_allProposals$i5$resu,_allProposals$i5$resu2,_allProposals$i6,_allProposals$i6$resu,_allProposals$i6$resu2;var description=PRELOADED_PROPOSALS.get(allProposals.length-i-1)||formattedEvents[i].description;var formattedProposal={id:(_allProposals$i=allProposals[i])===null||_allProposals$i===void 0?void 0:(_allProposals$i$resul=_allProposals$i.result)===null||_allProposals$i$resul===void 0?void 0:_allProposals$i$resul.id.toString(),title:(description===null||description===void 0?void 0:description.split(/# |\\n/g)[1])||'Untitled',description:description||'No description.',proposer:(_allProposals$i2=allProposals[i])===null||_allProposals$i2===void 0?void 0:(_allProposals$i2$resu=_allProposals$i2.result)===null||_allProposals$i2$resu===void 0?void 0:_allProposals$i2$resu.proposer,status:(_enumerateProposalSta=enumerateProposalState((_allProposalStates$i2=allProposalStates[i])===null||_allProposalStates$i2===void 0?void 0:(_allProposalStates$i3=_allProposalStates$i2.result)===null||_allProposalStates$i3===void 0?void 0:_allProposalStates$i3[0]))!==null&&_enumerateProposalSta!==void 0?_enumerateProposalSta:'Undetermined',forCount:parseFloat(ethers.utils.formatUnits((_allProposals$i3=allProposals[i])===null||_allProposals$i3===void 0?void 0:(_allProposals$i3$resu=_allProposals$i3.result)===null||_allProposals$i3$resu===void 0?void 0:_allProposals$i3$resu.forVotes.toString(),18)),againstCount:parseFloat(ethers.utils.formatUnits((_allProposals$i4=allProposals[i])===null||_allProposals$i4===void 0?void 0:(_allProposals$i4$resu=_allProposals$i4.result)===null||_allProposals$i4$resu===void 0?void 0:_allProposals$i4$resu.againstVotes.toString(),18)),startBlock:parseInt((_allProposals$i5=allProposals[i])===null||_allProposals$i5===void 0?void 0:(_allProposals$i5$resu=_allProposals$i5.result)===null||_allProposals$i5$resu===void 0?void 0:(_allProposals$i5$resu2=_allProposals$i5$resu.startBlock)===null||_allProposals$i5$resu2===void 0?void 0:_allProposals$i5$resu2.toString()),endBlock:parseInt((_allProposals$i6=allProposals[i])===null||_allProposals$i6===void 0?void 0:(_allProposals$i6$resu=_allProposals$i6.result)===null||_allProposals$i6$resu===void 0?void 0:(_allProposals$i6$resu2=_allProposals$i6$resu.endBlock)===null||_allProposals$i6$resu2===void 0?void 0:_allProposals$i6$resu2.toString()),details:formattedEvents[i].details};return formattedProposal;});}else{return[];}}export function useProposalData(id){var allProposalData=useAllProposalData();return allProposalData===null||allProposalData===void 0?void 0:allProposalData.find(function(p){return p.id===id;});}// get the users delegatee if it exists\nexport function useUserDelegatee(){var _result$;var _useActiveWeb3React2=useActiveWeb3React(),account=_useActiveWeb3React2.account;var uniContract=useUniContract();var _useSingleCallResult=useSingleCallResult(uniContract,'delegates',[account!==null&&account!==void 0?account:undefined]),result=_useSingleCallResult.result;return(_result$=result===null||result===void 0?void 0:result[0])!==null&&_result$!==void 0?_result$:undefined;}// gets the users current votes\nexport function useUserVotes(){var _useSingleCallResult2,_useSingleCallResult3;var _useActiveWeb3React3=useActiveWeb3React(),account=_useActiveWeb3React3.account,chainId=_useActiveWeb3React3.chainId;var uniContract=useUniContract();// check for available votes\nvar uni=chainId?UNI[chainId]:undefined;var votes=(_useSingleCallResult2=useSingleCallResult(uniContract,'getCurrentVotes',[account!==null&&account!==void 0?account:undefined]))===null||_useSingleCallResult2===void 0?void 0:(_useSingleCallResult3=_useSingleCallResult2.result)===null||_useSingleCallResult3===void 0?void 0:_useSingleCallResult3[0];return votes&&uni?new TokenAmount(uni,votes):undefined;}// fetch available votes as of block (usually proposal start block)\nexport function useUserVotesAsOfBlock(block){var _useSingleCallResult4,_useSingleCallResult5;var _useActiveWeb3React4=useActiveWeb3React(),account=_useActiveWeb3React4.account,chainId=_useActiveWeb3React4.chainId;var uniContract=useUniContract();// check for available votes\nvar uni=chainId?UNI[chainId]:undefined;var votes=(_useSingleCallResult4=useSingleCallResult(uniContract,'getPriorVotes',[account!==null&&account!==void 0?account:undefined,block!==null&&block!==void 0?block:undefined]))===null||_useSingleCallResult4===void 0?void 0:(_useSingleCallResult5=_useSingleCallResult4.result)===null||_useSingleCallResult5===void 0?void 0:_useSingleCallResult5[0];return votes&&uni?new TokenAmount(uni,votes):undefined;}export function useDelegateCallback(){var _useActiveWeb3React5=useActiveWeb3React(),account=_useActiveWeb3React5.account,chainId=_useActiveWeb3React5.chainId,library=_useActiveWeb3React5.library;var addTransaction=useTransactionAdder();var uniContract=useUniContract();return useCallback(function(delegatee){var _uniContract$estimate;if(!library||!chainId||!account||!isAddress(delegatee!==null&&delegatee!==void 0?delegatee:''))return undefined;var args=[delegatee];if(!uniContract)throw new Error('No UNI Contract!');return(_uniContract$estimate=uniContract.estimateGas).delegate.apply(_uniContract$estimate,args.concat([{}])).then(function(estimatedGasLimit){return uniContract.delegate.apply(uniContract,args.concat([{value:null,gasLimit:calculateGasMargin(estimatedGasLimit)}])).then(function(response){addTransaction(response,{summary:\"Delegated votes\"});return response.hash;});});},[account,addTransaction,chainId,library,uniContract]);}export function useVoteCallback(){var _useActiveWeb3React6=useActiveWeb3React(),account=_useActiveWeb3React6.account;var govContract=useGovernanceContract();var addTransaction=useTransactionAdder();var voteCallback=useCallback(function(proposalId,support){var _govContract$estimate;if(!account||!govContract||!proposalId)return;var args=[proposalId,support];return(_govContract$estimate=govContract.estimateGas).castVote.apply(_govContract$estimate,args.concat([{}])).then(function(estimatedGasLimit){return govContract.castVote.apply(govContract,args.concat([{value:null,gasLimit:calculateGasMargin(estimatedGasLimit)}])).then(function(response){addTransaction(response,{summary:\"Voted \".concat(support?'for ':'against',\" proposal \").concat(proposalId)});return response.hash;});});},[account,addTransaction,govContract]);return{voteCallback:voteCallback};}","map":{"version":3,"sources":["C:/Users/Darrius/Documents/GitHub/swap-interface/src/state/governance/hooks.ts"],"names":["UNI","PRELOADED_PROPOSALS","TokenAmount","isAddress","useGovernanceContract","useUniContract","useSingleCallResult","useSingleContractMultipleData","useActiveWeb3React","ethers","utils","calculateGasMargin","useTransactionAdder","useState","useEffect","useCallback","abi","GOV_ABI","enumerateProposalState","state","proposalStates","useProposalCount","gov","res","result","loading","parseInt","undefined","useDataFromEventLogs","library","formattedEvents","setFormattedEvents","govContract","filter","filters","fromBlock","toBlock","eventParser","Interface","fetchData","getLogs","pastEvents","formattedEventData","map","event","eventParsed","parseLog","args","description","details","targets","target","i","signature","signatures","substr","length","split","name","types","calldata","calldatas","decoded","defaultAbiCoder","decode","functionSig","callData","join","reverse","useAllProposalData","proposalCount","proposalIndexes","push","allProposals","allProposalStates","p","Boolean","get","formattedProposal","id","toString","title","proposer","status","forCount","parseFloat","formatUnits","forVotes","againstCount","againstVotes","startBlock","endBlock","useProposalData","allProposalData","find","useUserDelegatee","account","uniContract","useUserVotes","chainId","uni","votes","useUserVotesAsOfBlock","block","useDelegateCallback","addTransaction","delegatee","Error","estimateGas","delegate","then","estimatedGasLimit","value","gasLimit","response","summary","hash","useVoteCallback","voteCallback","proposalId","support","castVote"],"mappings":"gsBAAA,OAASA,GAAT,CAAcC,mBAAd,KAAyC,yBAAzC,CACA,OAASC,WAAT,KAA4B,cAA5B,CACA,OAASC,SAAT,KAA0B,kBAA1B,CACA,OAASC,qBAAT,CAAgCC,cAAhC,KAAsD,yBAAtD,CACA,OAASC,mBAAT,CAA8BC,6BAA9B,KAAmE,oBAAnE,CACA,OAASC,kBAAT,KAAmC,aAAnC,CACA,OAASC,MAAT,CAAiBC,KAAjB,KAA8B,QAA9B,CACA,OAASC,kBAAT,KAAmC,aAAnC,CAEA,OAASC,mBAAT,KAAoC,uBAApC,CACA,OAASC,QAAT,CAAmBC,SAAnB,CAA8BC,WAA9B,KAAiD,OAAjD,CACA,OAASC,GAAG,GAAIC,CAAAA,OAAhB,KAA+B,8CAA/B,CAqBA,GAAMC,CAAAA,sBAAsB,CAAG,QAAzBA,CAAAA,sBAAyB,CAACC,KAAD,CAAmB,CAChD,GAAMC,CAAAA,cAAc,CAAG,CAAC,SAAD,CAAY,QAAZ,CAAsB,UAAtB,CAAkC,UAAlC,CAA8C,WAA9C,CAA2D,QAA3D,CAAqE,SAArE,CAAgF,UAAhF,CAAvB,CACA,MAAOA,CAAAA,cAAc,CAACD,KAAD,CAArB,CACD,CAHD,CAKA;AACA,MAAO,SAASE,CAAAA,gBAAT,EAAgD,CACrD,GAAMC,CAAAA,GAAG,CAAGlB,qBAAqB,EAAjC,CACA,GAAMmB,CAAAA,GAAG,CAAGjB,mBAAmB,CAACgB,GAAD,CAAM,eAAN,CAA/B,CACA,GAAIC,GAAG,CAACC,MAAJ,EAAc,CAACD,GAAG,CAACE,OAAvB,CAAgC,CAC9B,MAAOC,CAAAA,QAAQ,CAACH,GAAG,CAACC,MAAJ,CAAW,CAAX,CAAD,CAAf,CACD,CACD,MAAOG,CAAAA,SAAP,CACD,CAED;;;GAIA,MAAO,SAASC,CAAAA,oBAAT,EAAgC,kDACjBpB,kBAAkB,EADD,CAC7BqB,OAD6B,qBAC7BA,OAD6B,eAEShB,QAAQ,EAFjB,wCAE9BiB,eAF8B,eAEbC,kBAFa,eAGrC,GAAMC,CAAAA,WAAW,CAAG5B,qBAAqB,EAAzC,CAEA;AACA,GAAM6B,CAAAA,MAAM,gCAAQD,WAAR,SAAQA,WAAR,uCAAQA,WAAW,CAAEE,OAArB,+CAAQ,qBAAuB,iBAAvB,GAAR,MAAqDC,SAAS,CAAE,CAAhE,CAAmEC,OAAO,CAAE,QAA5E,EAAZ,CACA,GAAMC,CAAAA,WAAW,CAAG,GAAI5B,CAAAA,MAAM,CAACC,KAAP,CAAa4B,SAAjB,CAA2BrB,OAA3B,CAApB,CAEAH,SAAS,CAAC,UAAM,SACCyB,CAAAA,SADD,qIACd,2LAC2BV,CAAAA,OAD3B,SAC2BA,OAD3B,iBAC2BA,OAAO,CAAEW,OAAT,CAAiBP,MAAjB,CAD3B,QACQQ,UADR,eAEE;AACMC,kBAHR,CAG6BD,UAH7B,SAG6BA,UAH7B,iBAG6BA,UAAU,CACjCE,GADuB,CACnB,SAAAC,KAAK,CAAI,CACb,GAAMC,CAAAA,WAAW,CAAGR,WAAW,CAACS,QAAZ,CAAqBF,KAArB,EAA4BG,IAAhD,CACA,MAAO,CACLC,WAAW,CAAEH,WAAW,CAACG,WADpB,CAELC,OAAO,CAAEJ,WAAW,CAACK,OAAZ,CAAoBP,GAApB,CAAwB,SAACQ,MAAD,CAAiBC,CAAjB,CAA+B,CAC9D,GAAMC,CAAAA,SAAS,CAAGR,WAAW,CAACS,UAAZ,CAAuBF,CAAvB,CAAlB,CAD8D,0BAExCC,SAAS,CAACE,MAAV,CAAiB,CAAjB,CAAoBF,SAAS,CAACG,MAAV,CAAmB,CAAvC,EAA0CC,KAA1C,CAAgD,GAAhD,CAFwC,gEAEvDC,IAFuD,2BAEjDC,KAFiD,2BAI9D,GAAMC,CAAAA,QAAQ,CAAGf,WAAW,CAACgB,SAAZ,CAAsBT,CAAtB,CAAjB,CACA,GAAMU,CAAAA,OAAO,CAAGpD,KAAK,CAACqD,eAAN,CAAsBC,MAAtB,CAA6BL,KAAK,CAACF,KAAN,CAAY,GAAZ,CAA7B,CAA+CG,QAA/C,CAAhB,CAEA,MAAO,CACLT,MAAM,CAANA,MADK,CAELc,WAAW,CAAEP,IAFR,CAGLQ,QAAQ,CAAEJ,OAAO,CAACK,IAAR,CAAa,IAAb,CAHL,CAAP,CAKD,CAZQ,CAFJ,CAAP,CAgBD,CAnBwB,EAoBxBC,OApBwB,EAH7B,CAwBErC,kBAAkB,CAACW,kBAAD,CAAlB,CAxBF,sDADc,4CA2Bd,GAAI,CAACZ,eAAL,CAAsB,CACpBS,SAAS,GACV,CACF,CA9BQ,CA8BN,CAACF,WAAD,CAAcJ,MAAd,CAAsBJ,OAAtB,CAA+BC,eAA/B,CA9BM,CAAT,CAgCA,MAAOA,CAAAA,eAAP,CACD,CAED;AACA,MAAO,SAASuC,CAAAA,kBAAT,EAA8B,CACnC,GAAMC,CAAAA,aAAa,CAAGjD,gBAAgB,EAAtC,CACA,GAAMW,CAAAA,WAAW,CAAG5B,qBAAqB,EAAzC,CAEA,GAAMmE,CAAAA,eAAe,CAAG,EAAxB,CACA,IAAK,GAAInB,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,GAAKkB,aAAL,SAAKA,aAAL,UAAKA,aAAL,CAAsB,CAAtB,CAAjB,CAA2ClB,CAAC,EAA5C,CAAgD,CAC9CmB,eAAe,CAACC,IAAhB,CAAqB,CAACpB,CAAD,CAArB,EACD,CAED;AACA,GAAMtB,CAAAA,eAAe,CAAGF,oBAAoB,EAA5C,CAEA;AACA,GAAM6C,CAAAA,YAAY,CAAGlE,6BAA6B,CAACyB,WAAD,CAAc,WAAd,CAA2BuC,eAA3B,CAAlD,CAEA;AACA,GAAMG,CAAAA,iBAAiB,CAAGnE,6BAA6B,CAACyB,WAAD,CAAc,OAAd,CAAuBuC,eAAvB,CAAvD,CAEA,GAAIzC,eAAe,EAAI2C,YAAnB,EAAmCC,iBAAvC,CAA0D,CACxDD,YAAY,CAACL,OAAb,GACAM,iBAAiB,CAACN,OAAlB,GAEA,MAAOK,CAAAA,YAAY,CAChBxC,MADI,CACG,SAAC0C,CAAD,CAAIvB,CAAJ,CAAU,0BAChB,MAAOwB,CAAAA,OAAO,CAACD,CAAC,CAACnD,MAAH,CAAP,EAAqBoD,OAAO,uBAACF,iBAAiB,CAACtB,CAAD,CAAlB,+CAAC,qBAAsB5B,MAAvB,CAA5B,EAA8DoD,OAAO,CAAC9C,eAAe,CAACsB,CAAD,CAAhB,CAA5E,CACD,CAHI,EAIJT,GAJI,CAIA,SAACgC,CAAD,CAAIvB,CAAJ,CAAU,8VACb,GAAMJ,CAAAA,WAAW,CAAG/C,mBAAmB,CAAC4E,GAApB,CAAwBJ,YAAY,CAACjB,MAAb,CAAsBJ,CAAtB,CAA0B,CAAlD,GAAwDtB,eAAe,CAACsB,CAAD,CAAf,CAAmBJ,WAA/F,CACA,GAAM8B,CAAAA,iBAA+B,CAAG,CACtCC,EAAE,kBAAEN,YAAY,CAACrB,CAAD,CAAd,iEAAE,gBAAiB5B,MAAnB,gDAAE,sBAAyBuD,EAAzB,CAA4BC,QAA5B,EADkC,CAEtCC,KAAK,CAAE,CAAAjC,WAAW,OAAX,EAAAA,WAAW,SAAX,QAAAA,WAAW,CAAES,KAAb,CAAmB,QAAnB,EAA6B,CAA7B,IAAmC,UAFJ,CAGtCT,WAAW,CAAEA,WAAW,EAAI,iBAHU,CAItCkC,QAAQ,mBAAET,YAAY,CAACrB,CAAD,CAAd,kEAAE,iBAAiB5B,MAAnB,gDAAE,sBAAyB0D,QAJG,CAKtCC,MAAM,wBAAEjE,sBAAsB,wBAACwD,iBAAiB,CAACtB,CAAD,CAAlB,uEAAC,sBAAsB5B,MAAvB,gDAAC,sBAA+B,CAA/B,CAAD,CAAxB,+DAA+D,cAL/B,CAMtC4D,QAAQ,CAAEC,UAAU,CAAC5E,MAAM,CAACC,KAAP,CAAa4E,WAAb,mBAAyBb,YAAY,CAACrB,CAAD,CAArC,kEAAyB,iBAAiB5B,MAA1C,gDAAyB,sBAAyB+D,QAAzB,CAAkCP,QAAlC,EAAzB,CAAuE,EAAvE,CAAD,CANkB,CAOtCQ,YAAY,CAAEH,UAAU,CAAC5E,MAAM,CAACC,KAAP,CAAa4E,WAAb,mBAAyBb,YAAY,CAACrB,CAAD,CAArC,kEAAyB,iBAAiB5B,MAA1C,gDAAyB,sBAAyBiE,YAAzB,CAAsCT,QAAtC,EAAzB,CAA2E,EAA3E,CAAD,CAPc,CAQtCU,UAAU,CAAEhE,QAAQ,mBAAC+C,YAAY,CAACrB,CAAD,CAAb,kEAAC,iBAAiB5B,MAAlB,wEAAC,sBAAyBkE,UAA1B,iDAAC,uBAAqCV,QAArC,EAAD,CARkB,CAStCW,QAAQ,CAAEjE,QAAQ,mBAAC+C,YAAY,CAACrB,CAAD,CAAb,kEAAC,iBAAiB5B,MAAlB,wEAAC,sBAAyBmE,QAA1B,iDAAC,uBAAmCX,QAAnC,EAAD,CAToB,CAUtC/B,OAAO,CAAEnB,eAAe,CAACsB,CAAD,CAAf,CAAmBH,OAVU,CAAxC,CAYA,MAAO6B,CAAAA,iBAAP,CACD,CAnBI,CAAP,CAoBD,CAxBD,IAwBO,CACL,MAAO,EAAP,CACD,CACF,CAED,MAAO,SAASc,CAAAA,eAAT,CAAyBb,EAAzB,CAA+D,CACpE,GAAMc,CAAAA,eAAe,CAAGxB,kBAAkB,EAA1C,CACA,MAAOwB,CAAAA,eAAP,SAAOA,eAAP,iBAAOA,eAAe,CAAEC,IAAjB,CAAsB,SAAAnB,CAAC,QAAIA,CAAAA,CAAC,CAACI,EAAF,GAASA,EAAb,EAAvB,CAAP,CACD,CAED;AACA,MAAO,SAASgB,CAAAA,gBAAT,EAAoC,uCACrBvF,kBAAkB,EADG,CACjCwF,OADiC,sBACjCA,OADiC,CAEzC,GAAMC,CAAAA,WAAW,CAAG5F,cAAc,EAAlC,CAFyC,yBAGtBC,mBAAmB,CAAC2F,WAAD,CAAc,WAAd,CAA2B,CAACD,OAAD,SAACA,OAAD,UAACA,OAAD,CAAYrE,SAAZ,CAA3B,CAHG,CAGjCH,MAHiC,sBAGjCA,MAHiC,CAIzC,gBAAOA,MAAP,SAAOA,MAAP,iBAAOA,MAAM,CAAG,CAAH,CAAb,qCAAsBG,SAAtB,CACD,CAED;AACA,MAAO,SAASuE,CAAAA,YAAT,EAAiD,0EACzB1F,kBAAkB,EADO,CAC9CwF,OAD8C,sBAC9CA,OAD8C,CACrCG,OADqC,sBACrCA,OADqC,CAEtD,GAAMF,CAAAA,WAAW,CAAG5F,cAAc,EAAlC,CAEA;AACA,GAAM+F,CAAAA,GAAG,CAAGD,OAAO,CAAGnG,GAAG,CAACmG,OAAD,CAAN,CAAkBxE,SAArC,CACA,GAAM0E,CAAAA,KAAK,wBAAG/F,mBAAmB,CAAC2F,WAAD,CAAc,iBAAd,CAAiC,CAACD,OAAD,SAACA,OAAD,UAACA,OAAD,CAAYrE,SAAZ,CAAjC,CAAtB,uEAAG,sBAA6EH,MAAhF,gDAAG,sBAAsF,CAAtF,CAAd,CACA,MAAO6E,CAAAA,KAAK,EAAID,GAAT,CAAe,GAAIlG,CAAAA,WAAJ,CAAgBkG,GAAhB,CAAqBC,KAArB,CAAf,CAA6C1E,SAApD,CACD,CAED;AACA,MAAO,SAAS2E,CAAAA,qBAAT,CAA+BC,KAA/B,CAAmF,0EAC3D/F,kBAAkB,EADyC,CAChFwF,OADgF,sBAChFA,OADgF,CACvEG,OADuE,sBACvEA,OADuE,CAExF,GAAMF,CAAAA,WAAW,CAAG5F,cAAc,EAAlC,CAEA;AACA,GAAM+F,CAAAA,GAAG,CAAGD,OAAO,CAAGnG,GAAG,CAACmG,OAAD,CAAN,CAAkBxE,SAArC,CACA,GAAM0E,CAAAA,KAAK,wBAAG/F,mBAAmB,CAAC2F,WAAD,CAAc,eAAd,CAA+B,CAACD,OAAD,SAACA,OAAD,UAACA,OAAD,CAAYrE,SAAZ,CAAuB4E,KAAvB,SAAuBA,KAAvB,UAAuBA,KAAvB,CAAgC5E,SAAhC,CAA/B,CAAtB,uEAAG,sBACVH,MADO,gDAAG,sBACD,CADC,CAAd,CAEA,MAAO6E,CAAAA,KAAK,EAAID,GAAT,CAAe,GAAIlG,CAAAA,WAAJ,CAAgBkG,GAAhB,CAAqBC,KAArB,CAAf,CAA6C1E,SAApD,CACD,CAED,MAAO,SAAS6E,CAAAA,mBAAT,EAA+F,0BAC9DhG,kBAAkB,EAD4C,CAC5FwF,OAD4F,sBAC5FA,OAD4F,CACnFG,OADmF,sBACnFA,OADmF,CAC1EtE,OAD0E,sBAC1EA,OAD0E,CAEpG,GAAM4E,CAAAA,cAAc,CAAG7F,mBAAmB,EAA1C,CAEA,GAAMqF,CAAAA,WAAW,CAAG5F,cAAc,EAAlC,CAEA,MAAOU,CAAAA,WAAW,CAChB,SAAC2F,SAAD,CAAmC,2BACjC,GAAI,CAAC7E,OAAD,EAAY,CAACsE,OAAb,EAAwB,CAACH,OAAzB,EAAoC,CAAC7F,SAAS,CAACuG,SAAD,SAACA,SAAD,UAACA,SAAD,CAAc,EAAd,CAAlD,CAAqE,MAAO/E,CAAAA,SAAP,CACrE,GAAMoB,CAAAA,IAAI,CAAG,CAAC2D,SAAD,CAAb,CACA,GAAI,CAACT,WAAL,CAAkB,KAAM,IAAIU,CAAAA,KAAJ,CAAU,kBAAV,CAAN,CAClB,MAAO,uBAAAV,WAAW,CAACW,WAAZ,EAAwBC,QAAxB,6BAAoC9D,IAApC,SAA0C,EAA1C,IAA8C+D,IAA9C,CAAmD,SAAAC,iBAAiB,CAAI,CAC7E,MAAOd,CAAAA,WAAW,CACfY,QADI,OAAAZ,WAAW,CACHlD,IADG,SACG,CAAEiE,KAAK,CAAE,IAAT,CAAeC,QAAQ,CAAEtG,kBAAkB,CAACoG,iBAAD,CAA3C,CADH,GAAX,CAEJD,IAFI,CAEC,SAACI,QAAD,CAAmC,CACvCT,cAAc,CAACS,QAAD,CAAW,CACvBC,OAAO,kBADgB,CAAX,CAAd,CAGA,MAAOD,CAAAA,QAAQ,CAACE,IAAhB,CACD,CAPI,CAAP,CAQD,CATM,CAAP,CAUD,CAfe,CAgBhB,CAACpB,OAAD,CAAUS,cAAV,CAA0BN,OAA1B,CAAmCtE,OAAnC,CAA4CoE,WAA5C,CAhBgB,CAAlB,CAkBD,CAED,MAAO,SAASoB,CAAAA,eAAT,EAEL,0BACoB7G,kBAAkB,EADtC,CACQwF,OADR,sBACQA,OADR,CAGA,GAAMhE,CAAAA,WAAW,CAAG5B,qBAAqB,EAAzC,CACA,GAAMqG,CAAAA,cAAc,CAAG7F,mBAAmB,EAA1C,CAEA,GAAM0G,CAAAA,YAAY,CAAGvG,WAAW,CAC9B,SAACwG,UAAD,CAAiCC,OAAjC,CAAsD,2BACpD,GAAI,CAACxB,OAAD,EAAY,CAAChE,WAAb,EAA4B,CAACuF,UAAjC,CAA6C,OAC7C,GAAMxE,CAAAA,IAAI,CAAG,CAACwE,UAAD,CAAaC,OAAb,CAAb,CACA,MAAO,uBAAAxF,WAAW,CAAC4E,WAAZ,EAAwBa,QAAxB,6BAAoC1E,IAApC,SAA0C,EAA1C,IAA8C+D,IAA9C,CAAmD,SAAAC,iBAAiB,CAAI,CAC7E,MAAO/E,CAAAA,WAAW,CACfyF,QADI,OAAAzF,WAAW,CACHe,IADG,SACG,CAAEiE,KAAK,CAAE,IAAT,CAAeC,QAAQ,CAAEtG,kBAAkB,CAACoG,iBAAD,CAA3C,CADH,GAAX,CAEJD,IAFI,CAEC,SAACI,QAAD,CAAmC,CACvCT,cAAc,CAACS,QAAD,CAAW,CACvBC,OAAO,iBAAWK,OAAO,CAAG,MAAH,CAAY,SAA9B,sBAAoDD,UAApD,CADgB,CAAX,CAAd,CAGA,MAAOL,CAAAA,QAAQ,CAACE,IAAhB,CACD,CAPI,CAAP,CAQD,CATM,CAAP,CAUD,CAd6B,CAe9B,CAACpB,OAAD,CAAUS,cAAV,CAA0BzE,WAA1B,CAf8B,CAAhC,CAiBA,MAAO,CAAEsF,YAAY,CAAZA,YAAF,CAAP,CACD","sourcesContent":["import { UNI, PRELOADED_PROPOSALS } from './../../constants/index'\r\nimport { TokenAmount } from '@uniswap/sdk'\r\nimport { isAddress } from 'ethers/lib/utils'\r\nimport { useGovernanceContract, useUniContract } from '../../hooks/useContract'\r\nimport { useSingleCallResult, useSingleContractMultipleData } from '../multicall/hooks'\r\nimport { useActiveWeb3React } from '../../hooks'\r\nimport { ethers, utils } from 'ethers'\r\nimport { calculateGasMargin } from '../../utils'\r\nimport { TransactionResponse } from '@ethersproject/providers'\r\nimport { useTransactionAdder } from '../transactions/hooks'\r\nimport { useState, useEffect, useCallback } from 'react'\r\nimport { abi as GOV_ABI } from '@uniswap/governance/build/GovernorAlpha.json'\r\n\r\ninterface ProposalDetail {\r\n  target: string\r\n  functionSig: string\r\n  callData: string\r\n}\r\n\r\nexport interface ProposalData {\r\n  id: string\r\n  title: string\r\n  description: string\r\n  proposer: string\r\n  status: string\r\n  forCount: number\r\n  againstCount: number\r\n  startBlock: number\r\n  endBlock: number\r\n  details: ProposalDetail[]\r\n}\r\n\r\nconst enumerateProposalState = (state: number) => {\r\n  const proposalStates = ['pending', 'active', 'canceled', 'defeated', 'succeeded', 'queued', 'expired', 'executed']\r\n  return proposalStates[state]\r\n}\r\n\r\n// get count of all proposals made\r\nexport function useProposalCount(): number | undefined {\r\n  const gov = useGovernanceContract()\r\n  const res = useSingleCallResult(gov, 'proposalCount')\r\n  if (res.result && !res.loading) {\r\n    return parseInt(res.result[0])\r\n  }\r\n  return undefined\r\n}\r\n\r\n/**\r\n * Need proposal events to get description data emitted from\r\n * new proposal event.\r\n */\r\nexport function useDataFromEventLogs() {\r\n  const { library } = useActiveWeb3React()\r\n  const [formattedEvents, setFormattedEvents] = useState<any>()\r\n  const govContract = useGovernanceContract()\r\n\r\n  // create filter for these specific events\r\n  const filter = { ...govContract?.filters?.['ProposalCreated'](), fromBlock: 0, toBlock: 'latest' }\r\n  const eventParser = new ethers.utils.Interface(GOV_ABI)\r\n\r\n  useEffect(() => {\r\n    async function fetchData() {\r\n      const pastEvents = await library?.getLogs(filter)\r\n      // reverse events to get them from newest to odlest\r\n      const formattedEventData = pastEvents\r\n        ?.map(event => {\r\n          const eventParsed = eventParser.parseLog(event).args\r\n          return {\r\n            description: eventParsed.description,\r\n            details: eventParsed.targets.map((target: string, i: number) => {\r\n              const signature = eventParsed.signatures[i]\r\n              const [name, types] = signature.substr(0, signature.length - 1).split('(')\r\n\r\n              const calldata = eventParsed.calldatas[i]\r\n              const decoded = utils.defaultAbiCoder.decode(types.split(','), calldata)\r\n\r\n              return {\r\n                target,\r\n                functionSig: name,\r\n                callData: decoded.join(', ')\r\n              }\r\n            })\r\n          }\r\n        })\r\n        .reverse()\r\n      setFormattedEvents(formattedEventData)\r\n    }\r\n    if (!formattedEvents) {\r\n      fetchData()\r\n    }\r\n  }, [eventParser, filter, library, formattedEvents])\r\n\r\n  return formattedEvents\r\n}\r\n\r\n// get data for all past and active proposals\r\nexport function useAllProposalData() {\r\n  const proposalCount = useProposalCount()\r\n  const govContract = useGovernanceContract()\r\n\r\n  const proposalIndexes = []\r\n  for (let i = 1; i <= (proposalCount ?? 0); i++) {\r\n    proposalIndexes.push([i])\r\n  }\r\n\r\n  // get metadata from past events\r\n  const formattedEvents = useDataFromEventLogs()\r\n\r\n  // get all proposal entities\r\n  const allProposals = useSingleContractMultipleData(govContract, 'proposals', proposalIndexes)\r\n\r\n  // get all proposal states\r\n  const allProposalStates = useSingleContractMultipleData(govContract, 'state', proposalIndexes)\r\n\r\n  if (formattedEvents && allProposals && allProposalStates) {\r\n    allProposals.reverse()\r\n    allProposalStates.reverse()\r\n\r\n    return allProposals\r\n      .filter((p, i) => {\r\n        return Boolean(p.result) && Boolean(allProposalStates[i]?.result) && Boolean(formattedEvents[i])\r\n      })\r\n      .map((p, i) => {\r\n        const description = PRELOADED_PROPOSALS.get(allProposals.length - i - 1) || formattedEvents[i].description\r\n        const formattedProposal: ProposalData = {\r\n          id: allProposals[i]?.result?.id.toString(),\r\n          title: description?.split(/# |\\n/g)[1] || 'Untitled',\r\n          description: description || 'No description.',\r\n          proposer: allProposals[i]?.result?.proposer,\r\n          status: enumerateProposalState(allProposalStates[i]?.result?.[0]) ?? 'Undetermined',\r\n          forCount: parseFloat(ethers.utils.formatUnits(allProposals[i]?.result?.forVotes.toString(), 18)),\r\n          againstCount: parseFloat(ethers.utils.formatUnits(allProposals[i]?.result?.againstVotes.toString(), 18)),\r\n          startBlock: parseInt(allProposals[i]?.result?.startBlock?.toString()),\r\n          endBlock: parseInt(allProposals[i]?.result?.endBlock?.toString()),\r\n          details: formattedEvents[i].details\r\n        }\r\n        return formattedProposal\r\n      })\r\n  } else {\r\n    return []\r\n  }\r\n}\r\n\r\nexport function useProposalData(id: string): ProposalData | undefined {\r\n  const allProposalData = useAllProposalData()\r\n  return allProposalData?.find(p => p.id === id)\r\n}\r\n\r\n// get the users delegatee if it exists\r\nexport function useUserDelegatee(): string {\r\n  const { account } = useActiveWeb3React()\r\n  const uniContract = useUniContract()\r\n  const { result } = useSingleCallResult(uniContract, 'delegates', [account ?? undefined])\r\n  return result?.[0] ?? undefined\r\n}\r\n\r\n// gets the users current votes\r\nexport function useUserVotes(): TokenAmount | undefined {\r\n  const { account, chainId } = useActiveWeb3React()\r\n  const uniContract = useUniContract()\r\n\r\n  // check for available votes\r\n  const uni = chainId ? UNI[chainId] : undefined\r\n  const votes = useSingleCallResult(uniContract, 'getCurrentVotes', [account ?? undefined])?.result?.[0]\r\n  return votes && uni ? new TokenAmount(uni, votes) : undefined\r\n}\r\n\r\n// fetch available votes as of block (usually proposal start block)\r\nexport function useUserVotesAsOfBlock(block: number | undefined): TokenAmount | undefined {\r\n  const { account, chainId } = useActiveWeb3React()\r\n  const uniContract = useUniContract()\r\n\r\n  // check for available votes\r\n  const uni = chainId ? UNI[chainId] : undefined\r\n  const votes = useSingleCallResult(uniContract, 'getPriorVotes', [account ?? undefined, block ?? undefined])\r\n    ?.result?.[0]\r\n  return votes && uni ? new TokenAmount(uni, votes) : undefined\r\n}\r\n\r\nexport function useDelegateCallback(): (delegatee: string | undefined) => undefined | Promise<string> {\r\n  const { account, chainId, library } = useActiveWeb3React()\r\n  const addTransaction = useTransactionAdder()\r\n\r\n  const uniContract = useUniContract()\r\n\r\n  return useCallback(\r\n    (delegatee: string | undefined) => {\r\n      if (!library || !chainId || !account || !isAddress(delegatee ?? '')) return undefined\r\n      const args = [delegatee]\r\n      if (!uniContract) throw new Error('No UNI Contract!')\r\n      return uniContract.estimateGas.delegate(...args, {}).then(estimatedGasLimit => {\r\n        return uniContract\r\n          .delegate(...args, { value: null, gasLimit: calculateGasMargin(estimatedGasLimit) })\r\n          .then((response: TransactionResponse) => {\r\n            addTransaction(response, {\r\n              summary: `Delegated votes`\r\n            })\r\n            return response.hash\r\n          })\r\n      })\r\n    },\r\n    [account, addTransaction, chainId, library, uniContract]\r\n  )\r\n}\r\n\r\nexport function useVoteCallback(): {\r\n  voteCallback: (proposalId: string | undefined, support: boolean) => undefined | Promise<string>\r\n} {\r\n  const { account } = useActiveWeb3React()\r\n\r\n  const govContract = useGovernanceContract()\r\n  const addTransaction = useTransactionAdder()\r\n\r\n  const voteCallback = useCallback(\r\n    (proposalId: string | undefined, support: boolean) => {\r\n      if (!account || !govContract || !proposalId) return\r\n      const args = [proposalId, support]\r\n      return govContract.estimateGas.castVote(...args, {}).then(estimatedGasLimit => {\r\n        return govContract\r\n          .castVote(...args, { value: null, gasLimit: calculateGasMargin(estimatedGasLimit) })\r\n          .then((response: TransactionResponse) => {\r\n            addTransaction(response, {\r\n              summary: `Voted ${support ? 'for ' : 'against'} proposal ${proposalId}`\r\n            })\r\n            return response.hash\r\n          })\r\n      })\r\n    },\r\n    [account, addTransaction, govContract]\r\n  )\r\n  return { voteCallback }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}